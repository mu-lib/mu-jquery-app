<!DOCTYPE html>
<html lang="en-US">
<head>
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
<script src="https://rawgit.com/mu-lib/mu-jquery-wire/v2.0.0/jquery.wire.js"></script>
<script src="https://rawgit.com/mu-lib/mu-jquery-crank/v1.1.1/jquery.crank.js"></script>
<script src="https://rawgit.com/mu-lib/mu-compose/v1.0.0/compose.js"></script>
<script src="https://rawgit.com/mu-lib/mu-compose/v1.0.0/constructor.js"></script>
<script src="https://rawgit.com/mu-lib/mu-compose/v1.0.0/prototype.js"></script>
<script src="https://rawgit.com/mu-lib/mu-compose/v1.0.0/regexp.js"></script>
<script src="https://rawgit.com/mu-lib/mu-jquery-hub/v1.0.0/hub.js"></script>
<script src="https://rawgit.com/mu-lib/mu-jquery-widget/v2.0.0/widget.js"></script>
<script src="https://rawgit.com/mu-lib/mu-jquery-widget/v2.0.0/compose.js"></script>
<script src="compose.js"></script>
<script src="hub.js"></script>
<script src="button.js"></script>
<script>
(function ($, hub) {
  // publish initial values on the `test` topic
  hub("test").publish("a", "b", "c");

  $(function () {
    var info = console.info.bind(console);
    var count = 0;

    $(document)
      // find elements with a `mu-wire` attribute
      .find("[mu-wire]")
      // wire elements from the `mu-wire` attribute
      .wire("mu-wire", function(module, index) {
        var result = window[module];
        var $element;

        switch ($.type(result)) {
          case "function":
            // create instance and update `$element` and `module`
            result = new result($element = $(this), module = module + "@" + ++count, hub);

            // update attribute
            $element.attr("mu-wire", function (i, attr) {
              attr = attr.split(/\s+/);
              attr[index] = module;
              return attr.join(" ");
            });
            break;

          case "undefined":
            break;

          default:
            throw new Error(c + " is not a supported type");
        }

        return result;
      })
      .done(info)
      // transform arguments to $widgets
      .then(function () {
        return $($.map(arguments, function (component) {
          return ($.isArray(component) ? component[0] : component).$element;
        }));
      })
      .done(info)
      // crank `initialize` on $widgets
      .then(function ($widgets) {
        return $widgets.crank("mu-wire", "initialize");
      })
      .done(info)
      // publish on the `test` topic
      .done(function() {
        hub("test").publish(1,2,3);
      })
      // add error handler
      .fail(console.error.bind(console));
  });
})(jQuery, window["mu-jquery-hub/hub"]("memory", "stopOnFalse"));
</script>
</head>
<body>
  <button mu-wire="mu-jquery-app/button mu-jquery-app/button">test1</button>
  <button mu-wire="mu-jquery-app/button">test2</button>
</body>
</html>
