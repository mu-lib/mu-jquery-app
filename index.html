<!DOCTYPE html>
<html lang="en-US">
<head>
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
<script src="https://cdn.rawgit.com/mu-lib/mu-jquery-wire/v1.1.0/jquery.wire.js"></script>
<script src="https://cdn.rawgit.com/mu-lib/mu-jquery-crank/v1.1.1/jquery.crank.js"></script>
<script src="https://rawgit.com/mu-lib/mu-compose/master/jquery.js"></script>
<script src="https://rawgit.com/mu-lib/mu-compose/master/composer.js"></script>
<script src="https://rawgit.com/mu-lib/mu-compose/master/constructor.js"></script>
<script src="https://rawgit.com/mu-lib/mu-compose/master/prototype.js"></script>
<script src="https://rawgit.com/mu-lib/mu-compose/master/dom.js"></script>
<script src="hub.js"></script>
<script src="compose.js"></script>
<script src="construct.js"></script>
<script src="component.js"></script>
<script>
(function ($, crank, slice, hub) {
  // publish some values that will be overridden
  hub("test").publish(true, false);

  $(function () {
    var info = console.info.bind(console);

    // publish initial values on the 'test' topic
    hub("test").publish("a", "b", "c");

    $(document)
      // wire elements
      .wire("mu-wire", function(module) {
        return window[module];
      }, hub)
      .done(info)
      // transform arguments to [component]
      .then(function () {
        return slice.call(arguments);
      })
      .done(info)
      // crank 'initialize' and 'start' on each component in sequence
      .then(function (components) {
        return $.when.apply(null, $.map(components, function (component) {
          var $element = component.$element;

          return crank.call($element, "mu-wire", "initialize").done(function () {
            return crank.call($element, "mu-wire", "start");
          });
        }));
      })
      .done(info)
      // publish on the 'test' topic
      .done(function() {
        hub("test").publish(1,2,3);
      })
      // add error handler
      .fail(console.error.bind(console));
  });
})(jQuery, jQuery.fn.crank, Array.prototype.slice, window["mu-jquery-app/hub"]);
</script>
</head>
<body>
  <button mu-wire="mu-jquery-app/component">test1</button>
  <button mu-wire="mu-jquery-app/component">test2</button>
</body>
</html>
